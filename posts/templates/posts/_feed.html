{% comment %}Reusable posts feed (create-post + posts list). Included by posts page and user dashboard.{% endcomment %}
<!-- CREATE POST FORM -->
<div class="create-post">
        <div class="create-post-header">
            <div class="avatar-circle">
                {{ request.user.username|first|upper }}
            </div>
            <span>Start a post</span>
        </div>

        <form method="post" action="{% url 'posts' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <textarea name="content" rows="3" placeholder="Share your thoughts..."></textarea>
            <input type="file" name="image" accept="image/*">
            <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:15px;">
                <button type="submit" class="main-btn">Post</button>
            </div>
        </form>
    </div>

    <!-- POSTS FEED -->
    {% for post in posts %}
        <div class="post-card">
            <div class="post-header">
                <span>{{ post.user.username }}</span>
                <span class="post-time">{{ post.created_at|timesince }} ago</span>
            </div>

            <div style="margin:15px 0;">
                <p>{{ post.content }}</p>
                {% if post.image %}
                    <div style="margin-top:10px;">
                        <img src="{{ post.image.url }}" alt="Post image" style="max-width:100%; border-radius:8px;">
                    </div>
                {% endif %}
            </div>

            <div class="post-actions">
                <!-- LIKE -->
                <form method="post" action="{% url 'like_post' post.id %}">
                    {% csrf_token %}
                    <button
                        type="button"
                        class="action-btn like-btn"
                        data-post-id="{{ post.id }}"
                    >
                        ğŸ‘ Like ({{ post.like_set.count }})
                    </button>
                </form>

                <!-- COMMENT -->
                <a href="#comment-form-{{ post.id }}" class="action-btn"
                   style="text-decoration:none; display:inline-block; text-align:center;">
                    ğŸ’¬ Comment
                </a>

                <!-- DELETE BUTTON -->
                {% if post.user == request.user %}
                    <form method="post" action="{% url 'delete_post' post.id %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit"
                                class="action-btn"
                                onclick="return confirm('Delete this post?')"
                                style="color:#e74c3c;">
                            ğŸ—‘ï¸ Delete
                        </button>
                    </form>
                {% endif %}
            </div>

            <!-- COMMENT FORM -->
            <div id="comment-form-{{ post.id }}" class="comment-form">
                <form method="post" action="{% url 'add_comment' post.id %}">
                    {% csrf_token %}
                    <textarea name="text" rows="2" placeholder="Write a comment..." style="width:100%;"></textarea>
                    <button type="submit" class="main-btn" style="margin-top:8px;">Comment</button>
                </form>
            </div>

            <!-- SHOW COMMENTS -->
            {% for comment in post.comments.all %}
                <div style="margin-top:10px; padding:10px; background:#f9f9f9; border-radius:6px;">
                    <strong>{{ comment.user.username }}</strong>
                    <span style="font-size:12px; color:#666;">{{ comment.created_at|timesince }} ago</span>
                    <p style="margin:5px 0 0 0;">{{ comment.text }}</p>
                </div>
            {% endfor %}
        </div>
    {% empty %}
        <p style="text-align:center; color:#666;">No posts yet. Create the first one!</p>
    {% endfor %}
